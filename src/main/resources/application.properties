# ======================================================================================================================
# Application
# ======================================================================================================================
quarkus.application.name=account-manager
quarkus.application.version=1.0.0
# Container Image Configuration
quarkus.container-image.registry=ghcr.io
quarkus.container-image.group=ai-pipestream
quarkus.container-image.name=account-manager
quarkus.container-image.tag=latest
quarkus.container-image.additional-tags=${quarkus.application.version}
# ======================================================================================================================
# HTTP / gRPC Configuration
# ======================================================================================================================
# Default HTTP configuration (gRPC server defaults come from pipestream-server). Context path matches app root name.
quarkus.http.host=0.0.0.0
quarkus.http.port=38105
quarkus.http.root-path=/account-manager
# Set gRPC message size limits for all clients (wildcard)
quarkus.grpc.clients."*".max-inbound-message-size=2147483647
# Dev configuration
%dev.quarkus.http.port=38105
%dev.quarkus.http.host=0.0.0.0
# Test configuration
%test.quarkus.http.test-port=0
# Testcontainers: use system property to force Docker API version
# Set via gradle.properties or system env: DOCKER_API_VERSION=1.44
# ======================================================================================================================
# Database Configuration
# ======================================================================================================================
# Datasource configuration
quarkus.datasource.db-kind=postgresql
quarkus.datasource.username=pipeline
quarkus.datasource.password=password
# Dev mode - use shared PostgreSQL dev service (port 5432) - shared database
%dev.quarkus.datasource.jdbc.url=jdbc:postgresql://localhost:5432/account
# Hibernate configuration - use current property names
# Dev: Use Flyway migrations to manage schema
%dev.quarkus.hibernate-orm.schema-management.strategy=none
%dev.quarkus.flyway.migrate-at-start=true
%dev.quarkus.flyway.baseline-on-migrate=true
%dev.quarkus.flyway.repair-at-start=true
# Test: Clean database and let Hibernate create schema with initial data
%test.quarkus.hibernate-orm.schema-management.strategy=drop-and-create
%test.quarkus.hibernate-orm.sql-load-script=import.sql
%test.quarkus.flyway.migrate-at-start=false
%test.quarkus.flyway.clean-at-start=true
# Prod: Use migrations
%prod.quarkus.hibernate-orm.schema-management.strategy=validate
%prod.quarkus.flyway.migrate-at-start=true
%prod.quarkus.datasource.jdbc.url=jdbc:postgresql://localhost:5432/account

# Common settings
quarkus.hibernate-orm.sql-load-script=no-file

# Test profile - use standard DevServices (PostgreSQL, Kafka via Quarkus, Apicurio via plugin)
%test.quarkus.devservices.enabled=true
%test.quarkus.datasource.devservices.enabled=true
%test.quarkus.datasource.devservices.db-name=account
%test.quarkus.kafka.devservices.enabled=true
# ======================================================================================================================
# Service Registration Configuration
# ======================================================================================================================
pipestream.registration.enabled=true
pipestream.registration.service-name=account-manager
pipestream.registration.description=Account management service for multi-tenant support
pipestream.registration.type=SERVICE
pipestream.registration.capabilities=account-management,multi-tenant
pipestream.registration.tags=account,management,core-service
# Pipestream server defaults
pipestream.server.class=core
%test.pipestream.registration.enabled=false
# ======================================================================================================================
# Account Service Configuration
# ======================================================================================================================
# Dev-only S3 bucket creation (disabled in production)
account.dev.s3-bucket-creation=false
%dev.account.dev.s3-bucket-creation=true
%test.account.dev.s3-bucket-creation=false
%prod.account.dev.s3-bucket-creation=false
# Repository service gRPC client configuration
quarkus.grpc.clients.repository-service.host=localhost
quarkus.grpc.clients.repository-service.port=38102
# ======================================================================================================================
# Apicurio Registry Configuration
# ======================================================================================================================
# Apicurio DevServices are auto-configured by the pipestream-apicurio-registry-protobuf extension
# ======================================================================================================================
# Kafka Channels
# ======================================================================================================================
# Account events channel
# Note: Connector ('smallrye-kafka') and Serializers (ProtobufKafkaSerializer/UUIDSerializer) are 
# AUTO-CONFIGURED by the quarkus-apicurio-registry-protobuf extension.
# DO NOT manually configure 'value.serializer' or 'connector' unless you need to override the defaults.
#
# We only need to specify the topic if it differs from the channel name.
mp.messaging.outgoing.account-events.topic=account-events

# Test incoming channel for validation
# Note: Deserializers are also auto-configured.
%test.mp.messaging.incoming.test-account-events.topic=account-events
%test.mp.messaging.incoming.test-account-events.failure-strategy=ignore
# ======================================================================================================================
# Kafka Configuration
# ======================================================================================================================
kafka.bootstrap.servers=${KAFKA_BOOTSTRAP_SERVERS:localhost:9094}
%dev.kafka.bootstrap.servers=localhost:9094
%prod.kafka.bootstrap.servers=kafka:9092
# Kafka Dev Services
%dev.quarkus.kafka.devservices.enabled=true
# Kafka connector configuration (profile-specific overrides)
%prod.mp.messaging.connector.smallrye-kafka.bootstrap.servers=${kafka.bootstrap.servers}
%prod.mp.messaging.connector.smallrye-kafka.apicurio.registry.url=http://apicurio-registry:8080/apis/registry/v3
